class n{constructor(){this.searchInput=document.querySelector("[data-search-input]"),this.postsGrid=document.querySelector(".posts-grid"),this.searchTimeout=null,this.searchDelay=500,this.searchInput&&this.init()}init(){this.searchInput.addEventListener("input",e=>{this.handleSearch(e.target.value)}),this.postsGrid&&this.postsGrid.classList.add("filterable-grid")}handleSearch(e){this.searchTimeout&&clearTimeout(this.searchTimeout),this.setLoadingState(!0),this.searchTimeout=setTimeout(()=>{this.performSearch(e)},this.searchDelay)}async performSearch(e){try{const s=this.getPostType(),t=this.getTaxonomy(),r=this.getTermId();console.log("Performing search:",{query:e,postType:s,taxonomy:t,termId:r});const a=new FormData;a.append("action","archive_filter_search"),a.append("nonce",window.sageData.nonce),a.append("search",e),a.append("post_type",s),a.append("paged",1),t&&r&&(a.append("taxonomy",t),a.append("term_id",r));const i=await fetch(window.sageData.ajaxUrl,{method:"POST",body:a});if(!i.ok)throw new Error("Network response was not ok");const o=await i.json();console.log("Search response:",o),o.success?(this.updateGrid(o.data.html),this.updateUrl(e)):(console.error("Search failed:",o.data),this.showError(o.data.message||"Search failed. Please try again."))}catch(s){console.error("Search error:",s),this.showError("An error occurred. Please try again.")}finally{this.setLoadingState(!1)}}updateGrid(e){console.log("updateGrid called, postsGrid element:",this.postsGrid),console.log("HTML to insert:",e.substring(0,200)+"..."),this.postsGrid?(this.postsGrid.style.opacity="0.5",this.postsGrid.style.transition="opacity 150ms ease-in-out",setTimeout(()=>{this.postsGrid.innerHTML=e,this.postsGrid.style.opacity="1",console.log("Grid updated successfully")},150)):console.error("postsGrid element not found!")}updateUrl(e){const s=new URL(window.location);e&&e.trim()!==""?s.searchParams.set("s",e):s.searchParams.delete("s"),window.history.pushState({},"",s)}setLoadingState(e){const s=document.querySelector(".search-icon"),t=document.querySelector(".search-loading");e?(s&&s.classList.add("hidden"),t&&t.classList.remove("hidden"),this.searchInput&&this.searchInput.classList.add("opacity-50")):(s&&s.classList.remove("hidden"),t&&t.classList.add("hidden"),this.searchInput&&this.searchInput.classList.remove("opacity-50"))}showError(e){console.error(e)}getPostType(){const e=document.body.className;return e.includes("post-type-archive-case")||e.includes("tax-case_category")?"case":"post"}getTaxonomy(){const e=document.body.className;return e.includes("tax-case_category")?"case_category":e.includes("category")?"category":null}getTermId(){const e=document.body.className.split(" ");for(const s of e)if(s.startsWith("term-"))return s.replace("term-","");return null}}document.addEventListener("DOMContentLoaded",()=>{new n});
